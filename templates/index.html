<!DOCTYPE html>
<html lang="en">
<head>
    {% include "_analytics.html" %}

    <meta charset="UTF-8">

    {# Title and description  #}
    <title>Create a probability distribution from percentiles</title>
    <meta name="description" content="
    Fit probability distributions to quantiles (percentiles, points on a CDF). Go from a few known points to a complete distribution: fully characterize uncertainties. Make distributions for use in Monte Carlo simulation or forecasting.">

    {#  Other meta tags  #}
    {% include "_meta_tags.html" %}

    {# JQuery and JQuery UI #}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src={{url_for('static', filename="jquery-ui.1.12.1-custom.min.js")}}></script>
    <link rel="stylesheet" href= {{url_for('static', filename='jquery-ui.min.css') }}>

    {# D3 and plot.js #}
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src={{url_for('static', filename="plot.js")}}></script>

    {# MathJax   #}
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    {# Styles and Icons #}
    <link rel="stylesheet" type="text/css" href={{url_for('static', filename="styles.css")}}/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
</head>
<body>
{% from "_macros.html" import render_field, render_field_nolabel, render_checkbox, render_samples %}
{% from "_distribution.html" import display_distribution_input_output%}

<script>
    plotData = {} ;
    UIObjs = Array.from({length:{{form.n_distributions_to_display.data}}}).map(x => Object()) ;
</script>

<div id="inputsOutputs">
    <form method="POST" id="dataInputForm">
        <div class="hidden_field">{{ form.n_distributions_to_display }}</div>
        <script>
            n = parseInt($('#n_distributions_to_display').val())
            if (n>1 && {{ outputs_any|tojson }}){
            maxHeightPerDistr = window.innerHeight/(n+1)
                -n*9 // to deal with padding
            }
            else {
                maxHeightPerDistr = window.innerHeight
            }

             maxHeightPerPlot = maxHeightPerDistr/2
        </script>

        <div class="distributionBox" id="distribution99" distributionindex="99">
        <div class="left_pane">
            Mixture
            <div>
                {{ render_checkbox(form.mixture_domain_for_plot_bool,
                    onchange="displayConditionalFieldsByFieldType('mixture_domain_for_plot_bool','mixture_domain_for_plot_FromTo','99')")}}
                {{ render_field_nolabel(form.mixture_domain_for_plot_FromTo) }}
            </div>
        </div>

        <div class="results_pane">
            {% if mixture is not none %}
                <div class="plots"> {{ mixture.plot|safe }}</div>
                <script>makePlot(99)</script>

                <div class="samples_container">
                    {{ render_samples(mixture.samples_string,mixture.n_samples) }}
                </div>
            {% endif %}
        </div>
        </div>

        {% for i in range(form.distributions|length) %}
            {% if i<form.n_distributions_to_display.data and outputs_bool_array[i]%}
                {{ display_distribution_input_output(form.distributions[i], distributions_output[i], i, form.n_distributions_to_display.data)}}
            {% else %}
                {{ display_distribution_input_output(form.distributions[i], False, i, form.n_distributions_to_display.data)}}
            {% endif %}
        {% endfor %}
        <input type="submit">
    </form>
    <script src={{url_for('static', filename='index.js') }}></script>
    <a href="javascript:addDistr()" class="addDistrButton">Add another distribution to make a mixture</a>
</div>



<div id="examplesInstructions">
Examples:<ul>
<li><a href="javascript:displayMetalogExample()">Click here to see a metalog example</a>
<li><a href="javascript:displayGenBetaExample()">Click here to see a generalized beta example</a>
</ul>
<p>Pro tip: use the browser's forward and back buttons to navigate your result history.</p>


<div id="plotInstructions">
    {% if outputs_any %}
        <p><i>How to use the plot:
            <ul>
            <li> You can <b>drag</b> horizontal and vertical lines.
            <li> <b>Shift-drag</b> any line to move all lines at the same time.
            <li> <b>Alt-drag</b> any line to move all <span style="font-style:normal">greater</span> lines at the same time.
            <li> <b>Alt-Shift-drag</b> any line to move all <span style="font-style:normal">lesser</span> lines at the same time.
            <li> <b>Hover</b> over a point to display a draggable circle representing that point.
{#            <li> <b>Alt-click</b> a point to remove it. #} {# Commented out as this is currently broken #}
            <li> <b>Shift-click</b> on an empty area to add a point.
            </ul>
        </i></p>
    {% endif %}
</div>

</div>
<br><div>
    By <a href='https://tadamcz.github.io/'>Tom Adamczewski</a>.
    Code <a href='https://github.com/tadamcz/make-distribution'>on GitHub</a>.
    <div style="max-width: 40em">
        {% include "_feedback-form.html" %}
    </div>
</div>

</body>
</html>
